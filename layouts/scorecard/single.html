{{ define "main" }}
<main class="container scorecard-container">
    <!-- Header -->
    <header class="header">
        <a href="/" class="logo">indieco</a>
    </header>

    <!-- Scorecard Intro -->
    <section class="scorecard-intro" id="intro">
        <h1 class="scorecard-title">The Founder Readiness Scorecard</h1>
        <p class="scorecard-subtitle">Find out where you are in your journey — and what to focus on next.</p>
        <p class="scorecard-meta">10 questions · 2 minutes</p>
        <button class="btn btn-primary" onclick="startScorecard()">Start the scorecard</button>
    </section>

    <!-- Questions -->
    <section class="scorecard-questions" id="questions" style="display: none;">
        <div class="progress-bar">
            <div class="progress-fill" id="progress"></div>
        </div>
        
        <div class="question-container" id="question-container">
            <!-- Questions inserted by JS -->
        </div>
    </section>

    <!-- Email Capture -->
    <section class="scorecard-email" id="email-capture" style="display: none;">
        <h2>Almost there!</h2>
        <p>Enter your email to see your personalized results.</p>
        <form class="email-form" id="email-form" name="scorecard" method="POST" data-netlify="true">
            <input type="hidden" name="result" id="result-type">
            <input type="hidden" name="score" id="result-score">
            <input type="email" name="email" placeholder="Your email" required>
            <button type="submit" class="btn btn-primary">See my results</button>
        </form>
    </section>

    <!-- Results -->
    <section class="scorecard-result" id="result" style="display: none;">
        <div class="result-card" id="result-card">
            <!-- Result inserted by JS -->
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; indieco. All rights reserved.</p>
    </footer>
</main>

<script>
// Questions data
const questions = [
    {
        id: 1,
        question: "When someone asks what you're building, how do you feel?",
        options: [
            { text: "Confident — I nail it every time", scores: { clarity: 2, positioning: 2 } },
            { text: "Okay — but I ramble a bit", scores: { clarity: 1, positioning: 0 } },
            { text: "Awkward — I'm still figuring it out", scores: { clarity: 0, positioning: 0 } }
        ]
    },
    {
        id: 2,
        question: "How many ideas are you actively working on right now?",
        options: [
            { text: "One — I'm laser focused", scores: { clarity: 2 } },
            { text: "Two or three — they're related", scores: { clarity: 1 } },
            { text: "Too many — I can't say no", scores: { clarity: 0 } }
        ]
    },
    {
        id: 3,
        question: "If I asked your last 5 customers why they bought from you, would their answers match?",
        options: [
            { text: "Yes — they'd all say the same thing", scores: { positioning: 2 } },
            { text: "Mostly — with some variation", scores: { positioning: 1 } },
            { text: "No idea — I haven't asked", scores: { positioning: 0 } }
        ]
    },
    {
        id: 4,
        question: "How would you describe your customer acquisition right now?",
        options: [
            { text: "Predictable — I know what works", scores: { gtm: 2 } },
            { text: "Sporadic — some things work sometimes", scores: { gtm: 1 } },
            { text: "Random — mostly luck and referrals", scores: { gtm: 0 } }
        ]
    },
    {
        id: 5,
        question: "Do you have a clear 90-day priority?",
        options: [
            { text: "Yes — I know exactly what to focus on", scores: { clarity: 2 } },
            { text: "Sort of — but I get distracted", scores: { clarity: 1 } },
            { text: "No — every week feels different", scores: { clarity: 0 } }
        ]
    },
    {
        id: 6,
        question: "How different is your product/service from competitors?",
        options: [
            { text: "Very — we own a unique space", scores: { positioning: 2 } },
            { text: "Somewhat — we have a few edges", scores: { positioning: 1 } },
            { text: "Not much — we compete on price or hustle", scores: { positioning: 0 } }
        ]
    },
    {
        id: 7,
        question: "What's your biggest bottleneck right now?",
        options: [
            { text: "Getting more customers", scores: { gtm: 0 } },
            { text: "Explaining what makes us different", scores: { positioning: 0 } },
            { text: "Knowing what to focus on", scores: { clarity: 0 } },
            { text: "Raising capital", scores: { investor: 0 } }
        ]
    },
    {
        id: 8,
        question: "If an investor asked for your deck tomorrow, what would you send?",
        options: [
            { text: "A polished deck — ready to go", scores: { investor: 2 } },
            { text: "A rough draft — needs work", scores: { investor: 1 } },
            { text: "Nothing — I'd have to start from scratch", scores: { investor: 0 } }
        ]
    },
    {
        id: 9,
        question: "How do you feel about your pricing?",
        options: [
            { text: "Confident — it reflects our value", scores: { positioning: 2, gtm: 1 } },
            { text: "Uncertain — I wonder if it's too low", scores: { positioning: 1 } },
            { text: "Lost — I just guessed", scores: { positioning: 0 } }
        ]
    },
    {
        id: 10,
        question: "What stage feels most accurate for you?",
        options: [
            { text: "Pre-launch — still building", scores: { clarity: 0 } },
            { text: "Early — some customers, finding footing", scores: { gtm: 0, positioning: 0 } },
            { text: "Growing — traction, ready to scale or raise", scores: { investor: 1, gtm: 1 } }
        ]
    }
];

// Results data
const results = {
    clarity: {
        title: "You need Founder Clarity",
        subtitle: "Too many directions. Not enough focus.",
        description: "You're juggling ideas, opportunities, and possibilities — but without a clear 90-day priority, you'll stay scattered. Before you worry about marketing or fundraising, you need one path forward.",
        cta: "Get clarity",
        service: "Founder Clarity"
    },
    positioning: {
        title: "You need Brand Positioning",
        subtitle: "You know what you do. Others don't.",
        description: "Your product exists, but you can't articulate why it matters — or why you're different. Without a clear story, you'll keep competing on price and hustle instead of value.",
        cta: "Get positioned",
        service: "Brand Positioning"
    },
    gtm: {
        title: "You need a GTM Blueprint",
        subtitle: "You have something. Now you need customers.",
        description: "Your offering is clear, but traction is inconsistent. You need a repeatable playbook for getting customers — not just random tactics and hope.",
        cta: "Get traction",
        service: "GTM Blueprint"
    },
    investor: {
        title: "You need Investor Readiness",
        subtitle: "You're ready to raise. Your pitch isn't.",
        description: "You have traction and a story — but your pitch, deck, and investor narrative aren't there yet. Before you talk to investors, get ready to impress them.",
        cta: "Get ready",
        service: "Investor Readiness"
    }
};

// State
let currentQuestion = 0;
let scores = { clarity: 0, positioning: 0, gtm: 0, investor: 0 };

// Functions
function startScorecard() {
    document.getElementById('intro').style.display = 'none';
    document.getElementById('questions').style.display = 'block';
    showQuestion(0);
}

function showQuestion(index) {
    const container = document.getElementById('question-container');
    const q = questions[index];
    
    let optionsHtml = q.options.map((opt, i) => `
        <button class="option-btn" onclick="selectOption(${index}, ${i})">
            ${opt.text}
        </button>
    `).join('');
    
    container.innerHTML = `
        <p class="question-number">Question ${index + 1} of ${questions.length}</p>
        <h2 class="question-text">${q.question}</h2>
        <div class="options">
            ${optionsHtml}
        </div>
    `;
    
    // Update progress
    const progress = ((index) / questions.length) * 100;
    document.getElementById('progress').style.width = progress + '%';
}

function selectOption(questionIndex, optionIndex) {
    const option = questions[questionIndex].options[optionIndex];
    
    // Add scores
    if (option.scores) {
        for (let key in option.scores) {
            scores[key] = (scores[key] || 0) + option.scores[key];
        }
    }
    
    // Next question or show email capture
    if (questionIndex < questions.length - 1) {
        currentQuestion = questionIndex + 1;
        showQuestion(currentQuestion);
    } else {
        showEmailCapture();
    }
}

function showEmailCapture() {
    document.getElementById('questions').style.display = 'none';
    document.getElementById('email-capture').style.display = 'block';
    
    // Calculate result
    const resultType = calculateResult();
    document.getElementById('result-type').value = resultType;
    document.getElementById('result-score').value = JSON.stringify(scores);
}

function calculateResult() {
    // Find lowest scoring area (that's their gap)
    let lowest = 'clarity';
    let lowestScore = scores.clarity;
    
    for (let key in scores) {
        if (scores[key] < lowestScore) {
            lowestScore = scores[key];
            lowest = key;
        }
    }
    
    // Special case: if they indicated raising capital as bottleneck and have decent other scores
    if (scores.investor <= 2 && scores.clarity >= 3 && scores.positioning >= 3) {
        return 'investor';
    }
    
    return lowest;
}

// Handle form submission
document.getElementById('email-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Submit to Netlify
    const formData = new FormData(this);
    fetch('/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: new URLSearchParams(formData).toString()
    }).then(() => {
        showResult();
    }).catch(() => {
        // Show result anyway if form fails
        showResult();
    });
});

function showResult() {
    document.getElementById('email-capture').style.display = 'none';
    document.getElementById('result').style.display = 'block';
    
    const resultType = document.getElementById('result-type').value;
    const result = results[resultType];
    
    document.getElementById('result-card').innerHTML = `
        <p class="result-label">Your result</p>
        <h2 class="result-title">${result.title}</h2>
        <p class="result-subtitle">${result.subtitle}</p>
        <p class="result-description">${result.description}</p>
        <div class="result-cta">
            <a href="/#waitlist" class="btn btn-primary">${result.cta}</a>
            <a href="/" class="btn btn-secondary">Back to home</a>
        </div>
    `;
}
</script>
{{ end }}
